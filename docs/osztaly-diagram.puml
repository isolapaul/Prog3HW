@startuml Offline Chat - OsztÃ¡lydiagram

skinparam classAttributeIconSize 0
skinparam packageStyle rectangle
skinparam linetype ortho

' ===== MAIN =====
class Main {
    + {static} main(args): void
}

' ===== CONTROLLER =====
package "controller" {
    class AppController {
        - store: DataStore
        + registerUser(): RegistrationResult
        + authenticateUser(): boolean
        ...
    }
    
    enum RegistrationResult {
        SUCCESS
        USERNAME_TOO_SHORT
        ...
    }
}

' ===== MODEL =====
package "model" {
    class User {
        - id: UUID
        + getUsername(): String
        ...
    }
    
    class Message {
        - senderId: UUID
        + getContent(): String
        ...
    }
    
    class Group {
        - memberRoles: Map
        + addMember(): void
        + hasPermission(): boolean
        ...
    }
    
    class Permissions {
        + {static} ALL: String
        + {static} GROUP_SEND_MESSAGE: String
        ...
    }
}

' ===== PERSISTENCE =====
package "persistence" {
    class DataStore {
        - usersByName: Map
        + registerUser(): boolean
        + createGroup(): UUID
        ...
    }
    
    class FileManager {
        + {static} save(): boolean
        + {static} load(): DataStore
    }
}

' ===== UI =====
package "ui" {
    class LoginFrame {
        - controller: AppController
        - onLogin(): void
        ...
    }
    
    class MainFrame {
        - username: String
        - refreshFriends(): void
        ...
    }
    
    abstract class BaseChatWindow {
        # controller: AppController
        # {abstract} fetchMessages(): List
        ...
    }
    
    class PrivateChatWindow {
        - other: String
        + refreshIfVisible(): void
        ...
    }
    
    class GroupChatWindow {
        - groupId: UUID
        # canSendNow(): boolean
        ...
    }
    
    class GroupManager {
        - controller: AppController
        - loadGroups(): void
        ...
    }
}

package "util" {
    class PasswordUtil {
        + {static} hashPassword(): String
        + {static} checkPassword(): boolean
    }
}

' ===== RELATIONSHIPS =====

' Main -> Controller
Main ..> AppController : creates
Main ..> LoginFrame : creates

' Controller -> Model & Persistence
AppController --> DataStore : uses
AppController ..> RegistrationResult : returns
AppController ..> FileManager : saves/loads

' Persistence -> Model
DataStore *-- User
DataStore *-- Group
DataStore *-- Message
FileManager ..> DataStore : serializes

' Model
Group ..> Permissions : uses

' UI -> Controller
LoginFrame --> AppController
MainFrame --> AppController
BaseChatWindow --> AppController
GroupManager --> AppController

' UI relationships
MainFrame ..> GroupManager : opens
PrivateChatWindow --|> BaseChatWindow
GroupChatWindow --|> BaseChatWindow

' Util
LoginFrame ..> PasswordUtil
AppController ..> PasswordUtil

@enduml
